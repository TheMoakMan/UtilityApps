<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Habit Tracker</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
	<style>
		:root {
			--bg: #0f1115;
			--bg-alt: #181b21;
			--border: #2a3039;
			--text: #f5f7fa;
			--text-dim: #b3bcc9;
			--accent: #4f9cff;
			--accent-hover: #69adff;
			--danger: #ff5252;
			--warning: #ffb347;
			--radius: 14px;
			--focus: 2px solid var(--accent);
			color-scheme: dark;
			font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
		}
		* { box-sizing: border-box; }
		body { margin:0; background: var(--bg); color: var(--text); -webkit-font-smoothing: antialiased; }
		header { padding:1rem 1.15rem 0.75rem; position:sticky; top:0; background:linear-gradient(var(--bg) 70%,rgba(15,17,21,0)); z-index:5; }
		h1 { margin:0 0 .15rem; font-size: clamp(1.3rem,5vw,1.9rem); letter-spacing:.5px; }
		.date { font-size:.9rem; color: var(--text-dim); }
		main { padding:0 1rem 4rem; max-width:720px; margin:0 auto; }
		form#addHabitForm { display:flex; gap:.5rem; flex-wrap:wrap; background:var(--bg-alt); padding:.75rem .9rem .9rem; border:1px solid var(--border); border-radius: var(--radius); margin-bottom:1rem; }
		form#addHabitForm input[type=text]{ flex:2 1 180px; min-width:150px; padding:.55rem .7rem; border:1px solid var(--border); background:#1f242c; color:var(--text); border-radius:8px; }
		form#addHabitForm select { flex:1 1 120px; padding:.55rem .7rem; border:1px solid var(--border); background:#1f242c; color:var(--text); border-radius:8px; }
		form#addHabitForm button { padding:.6rem 1rem; background:var(--accent); border:none; color:#fff; font-weight:600; border-radius:8px; cursor:pointer; flex:0 0 auto; }
		form#addHabitForm button:hover, form#addHabitForm button:focus { background:var(--accent-hover); }
		section.list-group { margin-bottom:2rem; }
		section.list-group h2 { font-size:1.05rem; font-weight:600; margin:0 0 .5rem; display:flex; align-items:center; gap:.4rem; color: var(--text-dim); text-transform:uppercase; letter-spacing:.8px; }
		.habit-list { display:grid; gap:.65rem; margin:0; padding:0; list-style:none; }
		.habit-card { position:relative; display:flex; gap:.75rem; align-items:center; padding:.8rem .9rem; background: var(--bg-alt); border:1px solid var(--border); border-radius: var(--radius); cursor:pointer; transition: background .25s, border-color .25s; }
		.habit-card[data-completed=true]{ opacity:.65; background:#1d242d; }
		.habit-card:focus-visible { outline: var(--focus); outline-offset:2px; }
		.habit-main { flex:1 1 auto; min-width:0; }
		.habit-name { font-size:.97rem; margin:0 0 .15rem; font-weight:600; word-break:break-word; }
		.habit-meta { font-size:.65rem; letter-spacing:1px; text-transform:uppercase; color: var(--text-dim); }
		.habit-actions { display:flex; gap:.4rem; align-items:center; }
		.habit-actions button { background:#262c34; border:1px solid var(--border); color:var(--text-dim); padding:.45rem .55rem; font-size:.8rem; border-radius:8px; cursor:pointer; line-height:1; display:inline-flex; align-items:center; justify-content:center; }
		.habit-actions button:hover, .habit-actions button:focus { color: var(--text); border-color:#3a424e; }
		.habit-actions button.danger { color:#ffd5d5; border-color:#503030; background:#402020; }
		.habit-actions button.danger:hover { background:#521e1e; color:#fff; }
		.badge { display:inline-block; padding:.15rem .5rem .2rem; border-radius:1rem; font-size:.6rem; background:#243140; color: var(--accent); font-weight:600; letter-spacing:.5px; }
		.completed-badge { background:#203824; color:#52d470; }
		.empty { font-size:.9rem; color: var(--text-dim); padding:.6rem .2rem; }
		footer { position:fixed; bottom:0; left:0; right:0; background:linear-gradient(180deg,rgba(15,17,21,0),var(--bg) 35%,var(--bg) 100%); padding:2.5rem 1rem .9rem; font-size:.65rem; text-align:center; color: var(--text-dim); }
		/* Bottom sheet modal */
		.modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:flex-end; justify-content:center; z-index:50; }
		.modal-backdrop.active { display:flex; }
		.modal { width:100%; max-width:640px; background: var(--bg-alt); border-radius: 24px 24px 0 0; padding:1rem 1.1rem 1.5rem; box-shadow:0 -4px 16px rgba(0,0,0,.4); animation: slideUp .35s cubic-bezier(.4,.8,.3,1); }
		@keyframes slideUp { from { transform:translateY(35px); opacity:0; } to { transform:translateY(0); opacity:1; } }
		.modal header { position:static; background:transparent; padding:.25rem 0 .75rem; }
		.modal h2 { margin:.2rem 0 .2rem; font-size:1.15rem; }
		.modal form { display:flex; flex-direction:column; gap:.9rem; }
		.field { display:flex; flex-direction:column; gap:.35rem; }
		.field label { font-size:.7rem; letter-spacing:1px; font-weight:600; text-transform:uppercase; color: var(--text-dim); }
		.field input[type=text], .field select { padding:.65rem .75rem; background:#1f242c; border:1px solid var(--border); color: var(--text); border-radius:10px; font-size:.9rem; }
		.order-controls { display:flex; gap:.5rem; }
		.order-controls button { flex:1; padding:.65rem .75rem; background:#243140; border:1px solid #2f3d4a; color: var(--text); border-radius:10px; font-weight:600; cursor:pointer; }
		.order-controls button:hover { background:#2b3a49; }
		.modal .actions { display:flex; gap:.65rem; flex-wrap:wrap; }
		.modal .actions button { flex:1 1 auto; padding:.75rem .9rem; border-radius:12px; border:none; cursor:pointer; font-weight:600; letter-spacing:.5px; }
		.btn-primary { background: var(--accent); color:#fff; }
		.btn-primary:hover { background: var(--accent-hover); }
		.btn-secondary { background:#262c34; color: var(--text); }
		.btn-secondary:hover { background:#313a45; }
		.btn-danger { background: var(--danger); color:#fff; }
		.btn-danger:hover { filter:brightness(1.1); }
		.counts { font-size:.65rem; margin-top:.3rem; color: var(--text-dim); }
		.sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0 0 0 0); border:0; }
		@media (min-width:700px){
			form#addHabitForm { flex-wrap:nowrap; }
			.habit-card { padding:.9rem 1.05rem; }
		}
	</style>
</head>
<body class="container-lg">
	<header class="mb-3">
		<h1>Habit Tracker</h1>
		<div class="date" id="todayDate" aria-live="polite"></div>
	</header>
	<main>
		<form id="addHabitForm" autocomplete="off" aria-label="Add habit form">
			<input id="habitNameInput" name="habitName" type="text" placeholder="New habit" required aria-label="Habit name" />
			<select id="habitPartSelect" name="habitPart" aria-label="Day part">
				<option value="anytime">Anytime</option>
				<option value="morning">Morning</option>
				<option value="lunch">Lunch</option>
			</select>
			<button type="submit" aria-label="Add habit">Add</button>
			<div class="counts" id="habitCounts" aria-live="polite"></div>
		</form>
		<section class="list-group" aria-labelledby="incompleteHeading">
			<h2 id="incompleteHeading">Incomplete</h2>
			<ul id="incompleteList" class="habit-list" aria-live="polite"></ul>
		</section>
		<section class="list-group" aria-labelledby="completedHeading">
			<h2 id="completedHeading">Completed</h2>
			<ul id="completedList" class="habit-list" aria-live="polite"></ul>
		</section>
	</main>

	<div class="modal-backdrop" id="editModalBackdrop" aria-hidden="true">
		<div class="modal" role="dialog" aria-modal="true" aria-labelledby="editModalTitle">
			<header>
				<h2 id="editModalTitle">Edit Habit</h2>
			</header>
			<form id="editHabitForm">
				<div class="field">
					<label for="editName">Name</label>
					<input type="text" id="editName" required />
				</div>
				<div class="field">
					<label for="editPart">Part of day</label>
					<select id="editPart">
						<option value="anytime">Anytime</option>
						<option value="morning">Morning</option>
						<option value="lunch">Lunch</option>
					</select>
				</div>
				<div class="field">
					<label>Order</label>
					<div class="order-controls">
						<button type="button" id="orderUp" aria-label="Move up">▲</button>
						<button type="button" id="orderDown" aria-label="Move down">▼</button>
					</div>
				</div>
				<div class="actions">
					<button type="submit" class="btn-primary" aria-label="Save changes">Save</button>
					<button type="button" id="deleteHabitBtn" class="btn-danger" aria-label="Delete habit">Delete</button>
					<button type="button" id="cancelEditBtn" class="btn-secondary" aria-label="Cancel edit">Cancel</button>
				</div>
			</form>
		</div>
	</div>

	<footer class="text-center text-muted py-4 small">Data is stored only in your browser (localStorage). Clearing site data will remove it. No network usage.</footer>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script>
	(function(){
		"use strict";
		// Storage keys
		const HABITS_KEY = 'habitTracker.habits';
		const COMPLETIONS_KEY = 'habitTracker.completions';
		// Elements
		const todayDateEl = document.getElementById('todayDate');
		const addForm = document.getElementById('addHabitForm');
		const nameInput = document.getElementById('habitNameInput');
		const partSelect = document.getElementById('habitPartSelect');
		const incompleteListEl = document.getElementById('incompleteList');
		const completedListEl = document.getElementById('completedList');
		const countsEl = document.getElementById('habitCounts');
		const editBackdrop = document.getElementById('editModalBackdrop');
		const editForm = document.getElementById('editHabitForm');
		const editName = document.getElementById('editName');
		const editPart = document.getElementById('editPart');
		const orderUpBtn = document.getElementById('orderUp');
		const orderDownBtn = document.getElementById('orderDown');
		const deleteHabitBtn = document.getElementById('deleteHabitBtn');
		const cancelEditBtn = document.getElementById('cancelEditBtn');

		// App state
		let habits = loadJSON(HABITS_KEY, []);
		let completions = loadJSON(COMPLETIONS_KEY, {});
		let activeHabitId = null; // editing
		let lastFocus = null;

		const partOrder = { morning: 0, lunch: 1, anytime: 2 };
		const ORDER_STEP = 10;

		function todayKey(){
			return new Date().toISOString().slice(0,10);
		}
		const today = todayKey();
		if(!completions[today]) completions[today] = [];

		// Date display localized
		todayDateEl.textContent = new Date().toLocaleDateString(undefined, { weekday:'long', month:'long', day:'numeric', year:'numeric' });

		// Helpers
		function loadJSON(key, fallback){
			try { const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : fallback; } catch(e){ return fallback; }
		}
		function saveHabits(){ localStorage.setItem(HABITS_KEY, JSON.stringify(habits)); }
		function saveCompletions(){ localStorage.setItem(COMPLETIONS_KEY, JSON.stringify(completions)); }
		function generateId(){
			if(window.crypto && crypto.randomUUID) return crypto.randomUUID();
			return 'h_' + Math.random().toString(36).slice(2,11);
		}
		function normalizePartOrders(part){
			const partHabits = habits.filter(h=>h.part===part).sort((a,b)=>a.order-b.order || a.name.localeCompare(b.name));
			partHabits.forEach((h,i)=>{ h.order = i * ORDER_STEP; });
		}
		function normalizeAll(){ ['morning','lunch','anytime'].forEach(normalizePartOrders); }

		function addHabit(name, part){
			const h = { id: generateId(), name: name.trim(), part, order: nextOrderValue(part) };
			habits.push(h);
			normalizePartOrders(part);
			saveHabits();
			render();
		}
		function nextOrderValue(part){
			const partHabits = habits.filter(h=>h.part===part);
			if(!partHabits.length) return 0;
			return Math.max(...partHabits.map(h=>h.order)) + ORDER_STEP;
		}

		function setCompleted(habitId, done){
			const todayArr = completions[today];
			const idx = todayArr.indexOf(habitId);
			if(done && idx===-1) todayArr.push(habitId);
			if(!done && idx!==-1) todayArr.splice(idx,1);
			saveCompletions();
			render();
		}
		function deleteHabit(id){
			const index = habits.findIndex(h=>h.id===id);
			if(index===-1) return;
			const part = habits[index].part;
			habits.splice(index,1);
			// Purge from all days
			for(const day in completions){
				const arr = completions[day];
				const i = arr.indexOf(id);
				if(i!==-1) arr.splice(i,1);
			}
			normalizePartOrders(part);
			saveHabits(); saveCompletions(); render();
		}
		function reorderActive(delta){
			const habit = habits.find(h=>h.id===activeHabitId);
			if(!habit) return;
			habit.order += delta * ORDER_STEP;
			normalizePartOrders(habit.part);
			saveHabits();
			render();
			// Keep editing state consistent
			openEdit(habit.id, true);
		}
		function updateHabit(id, updates){
			const habit = habits.find(h=>h.id===id);
			if(!habit) return;
			const oldPart = habit.part;
			Object.assign(habit, updates);
			if(updates.part && updates.part !== oldPart){
				normalizePartOrders(oldPart); normalizePartOrders(habit.part);
			} else if('name' in updates){
				// keep order stable within part but re-normalize for consistency of order gaps
				normalizePartOrders(habit.part);
			}
			saveHabits();
			render();
		}
		function isCompleted(id){ return completions[today].includes(id); }

		function habitSort(a,b){
			const partCmp = (partOrder[a.part]??99) - (partOrder[b.part]??99);
			if(partCmp) return partCmp;
			const orderCmp = a.order - b.order; if(orderCmp) return orderCmp;
			return a.name.localeCompare(b.name);
		}

		function render(){
			const sorted = [...habits].sort(habitSort);
			const incomplete = []; const completed = [];
			sorted.forEach(h=> (isCompleted(h.id) ? completed : incomplete).push(h));

			renderList(incompleteListEl, incomplete, false);
			renderList(completedListEl, completed, true);

			if(!incomplete.length) incompleteListEl.innerHTML = '<li class="empty">All done 🎉</li>';
			if(!completed.length) completedListEl.innerHTML = '<li class="empty">No habits completed yet</li>';

			countsEl.textContent = `${completed.length} / ${sorted.length} done`;
		}

		function renderList(container, list, done){
			container.innerHTML='';
			list.forEach(habit=>{
				const li = document.createElement('li');
				li.className='habit-card';
				li.tabIndex=0;
				li.dataset.id = habit.id;
				li.dataset.completed = done;
				// Prevent button clicks from toggling card
				li.addEventListener('click', e=>{
					if(e.target.closest('button')) return; // button handles itself
					toggleCompleteWithConfirm(habit.id, done);
				});
				li.addEventListener('keydown', e=>{
					if(e.key==='Enter' || e.key===' '){ e.preventDefault(); toggleCompleteWithConfirm(habit.id, done); }
				});
				const main = document.createElement('div');
				main.className='habit-main';
				const nameEl = document.createElement('p'); nameEl.className='habit-name'; nameEl.textContent = habit.name;
				const meta = document.createElement('div'); meta.className='habit-meta'; meta.textContent = habit.part;
				main.appendChild(nameEl); main.appendChild(meta);
				const actions = document.createElement('div'); actions.className='habit-actions';
				const doneBtn = document.createElement('button');
				doneBtn.type='button';
				doneBtn.textContent = done ? 'Undo' : 'Done';
				doneBtn.setAttribute('aria-label', done ? 'Undo completion' : 'Mark done');
				doneBtn.addEventListener('click', ()=> toggleCompleteWithConfirm(habit.id, done));
				const editBtn = document.createElement('button');
				editBtn.type='button'; editBtn.innerHTML='✎'; editBtn.setAttribute('aria-label','Edit habit');
				editBtn.addEventListener('click', (e)=>{ e.stopPropagation(); openEdit(habit.id); });
				actions.appendChild(doneBtn); actions.appendChild(editBtn);
				li.appendChild(main); li.appendChild(actions);
				container.appendChild(li);
			});
		}

		function toggleCompleteWithConfirm(id, currentlyDone){
			const habit = habits.find(h=>h.id===id); if(!habit) return;
			const msg = currentlyDone ? `Undo ${habit.name}?` : `Mark ${habit.name} as done?`;
			if(!confirm(msg)) return;
			setCompleted(id, !currentlyDone);
		}

		// Modal handling
		function openEdit(id, keepFocus){
			const habit = habits.find(h=>h.id===id); if(!habit) return;
			activeHabitId = id;
			if(!keepFocus) lastFocus = document.activeElement;
			editName.value = habit.name;
			editPart.value = habit.part;
			editBackdrop.classList.add('active');
			editBackdrop.removeAttribute('aria-hidden');
			document.body.style.overflow='hidden';
			setTimeout(()=> editName.focus(), 60);
		}
		function closeEdit(){
			activeHabitId=null; editBackdrop.classList.remove('active'); editBackdrop.setAttribute('aria-hidden','true'); document.body.style.overflow='';
			if(lastFocus && lastFocus.focus) lastFocus.focus();
		}
		editBackdrop.addEventListener('click', e=>{ if(e.target===editBackdrop) closeEdit(); });
		document.addEventListener('keydown', e=>{ if(e.key==='Escape' && editBackdrop.classList.contains('active')) closeEdit(); });
		cancelEditBtn.addEventListener('click', closeEdit);

		editForm.addEventListener('submit', e=>{
			e.preventDefault();
			if(!activeHabitId) return;
			const name = editName.value.trim(); if(!name) { alert('Name required'); return; }
			updateHabit(activeHabitId, { name, part: editPart.value });
			closeEdit();
		});
		orderUpBtn.addEventListener('click', ()=> reorderActive(-1));
		orderDownBtn.addEventListener('click', ()=> reorderActive(1));
		deleteHabitBtn.addEventListener('click', ()=>{
			if(!activeHabitId) return;
			const habit = habits.find(h=>h.id===activeHabitId); if(!habit) return;
			if(confirm(`Delete habit "${habit.name}" and all its completion records?`)){
				deleteHabit(activeHabitId); closeEdit();
			}
		});

		// Add form
		addForm.addEventListener('submit', e=>{
			e.preventDefault();
			const name = nameInput.value.trim();
			if(!name){ nameInput.focus(); return; }
			addHabit(name, partSelect.value);
			nameInput.value='';
			nameInput.focus();
		});

		// Initial normalize & render
		normalizeAll(); render();
	})();
	</script>
</body>
</html>
